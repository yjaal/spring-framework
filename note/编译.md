# spring 源码编译

## 准备工作
* 1、从 [spring 官方地址](git@github.com:spring-projects/spring-framework.git) 将代码 `fork` 到自己到仓库中，然后从自己到仓库 `clone` 到本地
* 2、安装 `gradle-4.4` 和 `jdk1.8`， 配置好环境变量，此处略
* 3、进入 `spring` 目录中，切换到 `5.0.4.release` 分支，然后使用命令 `./gradlew` 进行编译。编译过程中可能会出现问题：`No such property: immutableValues for class:` ，参考 `https://www.jianshu.com/p/356be121ae8c` 解决。
* 4、然后使用命令
```
gradle objenesisRepackJar
gradle cglibRepackJar
```
下载相关依赖包即可

* 使用 `idea` 导入工程，注意 `gradle` 版本为 `4.4`



在编译过程中会报很多错误，特别是和`Flux`相关的，最好把`spring-tx`编译通过，编译的时候先编译`doc`，然后在编译整个工程。后面虽然还是会有`Flux`相关错误，但是我们在验证的时候已经可以使用相关`spring`注解了。



## 验证

创建一个`Config`类，然后使用注解`@Configuration`，如果可以正常使用就行，如果不行的话就表示有些`module`编译失败了，需要解决。

```java
package org.springframework.conf;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.pojo.Car;

@Configuration
public class Config {

	@Bean
	public Car getCar(){
    //随便创建个类即可
		return new Car();
	}
}
```



```java
package org.springframework;
import java.util.Arrays;
import org.springframework.conf.Config;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

public class TestApp {

	public static void main(String[] args) {
		AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(Config.class);
		String[] beanNames = context.getBeanDefinitionNames();
		Arrays.asList(beanNames).forEach(System.out::println);
	}
}
```



```groovy
group 'org.springframework'
version '5.2.0.BUILD-SNAPSHOT'

apply plugin: 'java'
sourceCompatibility = 1.8


repositories {
    mavenCentral()
}

dependencies {
    compile(project(":spring-context"))
    compile(project(":spring-instrument"))
    testCompile group: 'junit', name: 'junit', version: '4.12'
}
```





